\documentclass[a4paper,
               %boxit,
               %titlepage,   % separate title page
               %refpage      % separate references
              ]{jacow}
%
% CHANGE SEQUENCE OF GRAPHICS EXTENSION TO BE EMBEDDED
% ----------------------------------------------------
% test for XeTeX where the sequence is by default eps-> pdf, jpg, png, pdf, ...
%    and the JACoW template provides JACpic2v3.eps and JACpic2v3.jpg which
%    might generates errors, therefore PNG and JPG first
%
\makeatletter%
	\ifboolexpr{bool{xetex}}
	 {\renewcommand{\Gin@extensions}{.pdf,%
	                    .png,.jpg,.bmp,.pict,.tif,.psd,.mac,.sga,.tga,.gif,%
	                    .eps,.ps,%
	                    }}{}
\makeatother

% CHECK FOR XeTeX/LuaTeX BEFORE DEFINING AN INPUT ENCODING
% --------------------------------------------------------
%   utf8  is default for XeTeX/LuaTeX
%   utf8  in LaTeX only realises a small portion of codes
%
\ifboolexpr{bool{xetex} or bool{luatex}} % test for XeTeX/LuaTeX
 {}                                      % input encoding is utf8 by default
 {\usepackage[utf8]{inputenc}}           % switch to utf8

\usepackage[USenglish]{babel}

\usepackage[final]{pdfpages}
\usepackage{multirow}
\usepackage{ragged2e}
\usepackage{placeins}

%
% if BibLaTeX is used
%
\ifboolexpr{bool{jacowbiblatex}}%
 {%
  \addbibresource{jacow-test.bib}
  \addbibresource{biblatex-examples.bib}
 }{}
\listfiles

%
% command for typesetting a \section like word
%
\newcommand\SEC[1]{\textbf{\uppercase{#1}}}

%%
%%   Lengths for the spaces in the title
%%   \setlength\titleblockstartskip{..}  %before title, default 3pt
%%   \setlength\titleblockmiddleskip{..} %between title + author, default 1em
%%   \setlength\titleblockendskip{..}    %afterauthor, default 1em

%\copyrightspace %default 1cm. arbitrary size with e.g. \copyrightspace[2cm]

% testing to fill the copyright space
%\usepackage{eso-pic}
%\AddToShipoutPictureFG*{\AtTextLowerLeft{\textcolor{red}{COPYRIGHTSPACE}}}

\begin{document}

\title{High Level Applications for Sirius}

\author{I. Stevani\thanks{isabella.stevani@lnls.br}, N. Milas, X. R. Resende, L. N. P. Vilela\\ Brazilian Synchrotron Light Laboratory (LNLS), Campinas, Brazil}

\maketitle

%
\begin{abstract}
   Has been decided that Sirius will use EPICS as its distributed control system and this year the development of its High Level Applications started. Three development frameworks were chosen for building these applications: CS-Studio~\cite{css}, PyQt~\cite{pyqt} and Matlab Middle Layer~\cite{mml} (MML). Graphical user interfaces (GUI) and machine applications have already been designed and implemented for a few systems using CS-Studio and PyQt: slow orbit feedback, lifetime calculation and top-up injection. Specific Sirius data structures were added to the MML scripts in order to allow for EPICS communication through LabCA~\cite{labca}.
\end{abstract}


\section{INTRODUCTION}
Sirius is a Synchrotron Light Source Facility based on a 4th generation storage ring that is presently under construction at LNLS in Campinas, Brazil. The project initiated in 2008 with the first lattice studies and in the beginning of 2015 the building construction started. Machine commissioning is expected to start mid 2018~\cite{sirius_status}. By this time, indispensable control systems for beam stability -- such as tune measurement, orbit correction, injection -- should be ready for use, and so should their high level applications (HLAs).

To achieve this goal, the Accelerator Physics Group started developing these applications this year and should intensify its activity with HLA next year, after most of the group's work related to machine components' specifications -- that is currently taking most of the group efforts -- is done. A Virtual accelerator with channel access server (VACA)~\cite{vaca} has been implemented to emulate the real machine, thus providing a testbed environment for high level software development.


\section{APPLICATIONS FRAMEWORK}
Figure \ref{fig:f1} shows a schematic view of the application framework Sirius will use for HLA development. On a lower level, services are categorized in two groups: IOCs and machine applications. Both of them are Channel Access servers, the first providing control access to machine hardware while the second providing machine services. Machine applications developed so far were written in Python using PCASpy~\cite{pcaspy}. Virtual IOCs were implemented using EPICS Database on top of VACA in order to provide simulated fluctuations for machine parameters. EPICS V4 is another option for implementing machine applications that will be studied and discussed next year.

On top of Fig. \ref{fig:f1} are the HLAs. For basic process variable monitoring and settings with graphical user interface capabilities, CS-Studio was chosen due to its simplicity and fast learning curve. Most of the control system interface is expected to be implemented with CS-Studio. For software that requires elaborate logic, algorithms will either be implemented in the IOC level with simple driving GUI clients or using other options, such as PyQt or MML.

The control system can benefit from various support applications for storing and organizing system's parameters, IOC software, device and PV name lists, and so on. The plan is to use a few of the applications in development under the DISCS collaboration effort~\cite{discs_article,discs_openepics}. The device naming and configuration modules of DISCS are currently being tested and used in the HLA development framework. Other DISCS modules, such as its logbook, IOC  and machine save/restore services, will soon be tested as well.

\begin{figure}[!htb]
%   \vspace*{-.5\baselineskip}
  \centering
  \includegraphics*[width=230pt]{WEPOPRPO22f1}
  \caption{Applications framework schematic.}
  \label{fig:f1}
%   \vspace*{-\baselineskip}
\end{figure}

\FloatBarrier


\section{IMPLEMENTED APPLICATIONS}

Some prototypes were built on these platforms listed before to help the developers familiarize with their functionalities and evaluate if they are suitable for Sirius requirements. The HLAs are presented next.

\input{sofb.tex}
\FloatBarrier

\input{lifetime.tex}
\FloatBarrier

\input{topup.tex}
%\FloatBarrier


\section{CONCLUSION}
The development of Sirius' HLAs started this year. Three development frameworks were chosen and then tested on three important machine systems: SOFB, lifetime calculation and top-up injection. Results were promising and the plan is to continue improving these systems -- adding missing functionalities, for example -- and start the development of new HLAs such as LINAC gun and timing system controls, which are also fundamental to machine commissioning.

Also, has been decided that the control system could benefit from applications in development under the DISCS collaboration effort. Its device naming and configuration modules are currently being tested and used in the HLA development framework. Other DISCS modules will soon be tested as well.

\section{ACKNOWLEGMENTS}

The authors would like to thank L. M. Russo from the Diagnostics group for fruitful discussions on EPICS and for his help in configuring all services modules from DISCS which we have been testing.


\begin{thebibliography}{99}

\bibitem{css}
Control System Studio, \url{http://controlsystemstudio.org/}

\bibitem{pyqt}
PyQt, \url{https://wiki.python.org/moin/PyQt}

\bibitem{mml}
G. Portmann, J. Corbett and A. Terebilo,
"An accelerator control middle layer using MATLAB",
in \emph{Proc. PAC'05},
Knoxville, United States, May 2005,
paper FPAT077, pp. 4009-4011.

\bibitem{labca}
T. Straumann, "labCA -- An EPICS Channel Access Interface for scilab and matlab",
May 2008, \url{https://www.slac.stanford.edu/grp/ssrl/spear/epics/extensions/labca/manual/}

\bibitem{sirius_status}
A. R. D. Rodrigues \emph{et al.},
“Sirius status report”,
in \emph{Proc. IPAC'16},
Busan, Korea, May 2016,
paper WEPOW001, pp. 2811-2814.

\bibitem{vaca}
X. R. Resende, A. H. C. Mukai, L. N. P. Vilela and I. Stevani,
“Development of a virtual accelerator for Sirius”,
presented at the PCaPAC'16,
Campinas, Brazil, Oct. 2016,
paper WEPOPRPO21, this conference.

\bibitem{pcaspy}
PCASpy Documentation, \url{http://pcaspy.readthedocs.io/en/latest/}

\bibitem{discs_article}
V. Vuppala \emph{et al.},
"Distributed Information Services for Control Systems",
in \emph{Proc. ICALEPCS'2013},
San Francisco, United States, March 2014,
paper WECOBA02, pp. 1000-1003

\bibitem{discs_openepics}
DISCS, \url{http://openepics.sourceforge.net/about-discs/}

\bibitem{lifetime}
A. J. Burns \emph{et. al},
"Real time monitoring of LEP beam currents and lifetimes",
in \emph{Proc. EPAC'94},
London, England, pp. 1716-1718.

\bibitem{pyepics}
PyEpics,  \url{http://cars9.uchicago.edu/software/python/pyepics3/}

\end{thebibliography}

\end{document}
